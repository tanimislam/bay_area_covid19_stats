<!-- 
     Follow instructions from https://stackoverflow.com/questions/23211695/modifying-content-width-of-the-sphinx-theme-read-the-docs/33626140#33626140 on wideness in sphinx rtd_theme
     This is for layout.html
*/
--> 


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4.3. covid19_stats.engine.gis module &mdash; COVID19_STATS 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/covid19_stats.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.4. covid19_stats.engine.core module" href="covid19_stats_engine_core_api.html" />
    <link rel="prev" title="4.2. covid19_stats.engine module" href="covid19_stats_engine_api.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> COVID19_STATS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">1. GETTING STARTED</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">2. RESOURCES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/cli.html">3. USING THE CLI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api.html">4. THE COVID19_STATS API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="covid19_stats_api.html">4.1. covid19_stats module</a></li>
<li class="toctree-l2"><a class="reference internal" href="covid19_stats_engine_api.html">4.2. covid19_stats.engine module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.3. covid19_stats.engine.gis module</a></li>
<li class="toctree-l2"><a class="reference internal" href="covid19_stats_engine_core_api.html">4.4. covid19_stats.engine.core module</a></li>
<li class="toctree-l2"><a class="reference internal" href="covid19_stats_engine_viz_api.html">4.5. covid19_stats.engine.viz module</a></li>
<li class="toctree-l2"><a class="reference internal" href="covid19_stats_engine_viz2_api.html">4.6. covid19_stats.engine.viz2 module</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">COVID19_STATS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="api.html"><span class="section-number">4. </span>THE COVID19_STATS API</a> &raquo;</li>
        
      <li><span class="section-number">4.3. </span>covid19_stats.engine.gis module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/api/covid19_stats_engine_gis_api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="covid19-stats-engine-gis-module">
<h1><span class="section-number">4.3. </span>covid19_stats.engine.gis module<a class="headerlink" href="#covid19-stats-engine-gis-module" title="Permalink to this headline">¶</a></h1>
<p>The meat of the functionality, that generates post-processed <a class="reference external" href="https://en.wikipedia.org/wiki/Geographic_information_system">GIS</a> data describing the territorial units (counties, etc.) of the United States. Territorial unit information includes their identifiers, latitude and longitude boundary arrays as of 2018, and their estimated population in 2019.</p>
<span class="target" id="module-covid19_stats.engine.gis"></span><dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.calculate_total_bbox">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">calculate_total_bbox</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">shapes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.calculate_total_bbox" title="Permalink to this definition">¶</a></dt>
<dd><p>This gets the bounding box – minimum and maximum latitude, and minimum and maximum longitude – of a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of shapes.</p>
<p>For example, take the Sacramento, CA, metropolitan statistical area. It consists of four counties: El Dorado County, Placer County, Sacramento County, and Yolo County. <a class="reference internal" href="#gis-calculate-total-bbox-sacramento"><span class="std std-numref">Fig. 4.2</span></a> demonstrates how this algorithm works. It takes the bounding boxes of each county’s shape (shown in pink), and then takes the minimum and maximum latitude and longitude of each county’s bbox to get the <em>total</em> bounding box (in green).</p>
<div class="figure align-left" id="id2">
<span id="gis-calculate-total-bbox-sacramento"></span><a class="reference internal image-reference" href="../_images/gis_calculate_total_bbox_sacramento.png"><img alt="../_images/gis_calculate_total_bbox_sacramento.png" src="../_images/gis_calculate_total_bbox_sacramento.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 4.2 </span><span class="caption-text">Demonstration of this functionality on the four counties in the <a class="reference external" href="https://en.wikipedia.org/wiki/Sacramento_metropolitan_area">Sacramento, CA MSA</a>. In green is the total bounding box of the lat/longitude shapes of all four counties.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>Now here is the API description.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>shapes</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – A <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of shapes. Each shape is an <span class="math notranslate nohighlight">\(N \times 2\)</span> shaped <code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code>, with <span class="math notranslate nohighlight">\(N\)</span> points describing the boundary. Each row is the latitude and longitude of a point – first is the latitude, and second is the longitude. See <a class="reference download internal" download="" href="../_downloads/fd9403d1c766a71b9e77174e8db8426e/gis_calculate_total_bbox_sacramento.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">gis_calculate_total_bbox_sacramento.pkl.gz</span></code></a> for a clear example given by <a class="reference internal" href="#gis-calculate-total-bbox-sacramento"><span class="std std-numref">Fig. 4.2</span></a>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a four element <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of the total bounding box of the shape collection: minimum longitude, minimum latitude, maximum longitude, and maximum latitude.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.construct_adjacency">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">construct_adjacency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fips_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/usr/WS2/islam5/covid19_stats/covid19_stats/resources/fips_2019_adj.pkl.gz'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.construct_adjacency" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates, and then stores (or loads) the adjacency dictionary of all US counties and territorial units. If the storage file, which is by default <a class="reference download internal" download="" href="../_downloads/09c70b295d08e66f6009c0045bf34f85/fips_2019_adj.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">fips_2019_adj.pkl.gz</span></code></a>, does not exist, then will create and store this data into the storage file. Will return the data in the end.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fips_data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – the US county <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> produced by, for example, <code class="xref py py-meth docutils literal notranslate"><span class="pre">create_and_store_fips_2018</span></code>.</p></li>
<li><p><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – the location of the adjacency dictionary file, which is by default <a class="reference download internal" download="" href="../_downloads/09c70b295d08e66f6009c0045bf34f85/fips_2019_adj.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">fips_2019_adj.pkl.gz</span></code></a> located in the <code class="docutils literal notranslate"><span class="pre">covid19_stats</span></code> resource directory.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of adjacency. Each key is a <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a> of a county, and each value is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> of counties and other territories adjacent to it. See <a class="reference internal" href="#covid19_stats.engine.gis.get_fips_adjacency" title="covid19_stats.engine.gis.get_fips_adjacency"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_fips_adjacency</span></code></a> to see an example of this adjacency information for a single county.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.create_and_store_fips_2019">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">create_and_store_fips_2019</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.create_and_store_fips_2019" title="Permalink to this definition">¶</a></dt>
<dd><p>Utility function that loads in the US CENSUS 2018 county information, located in <a class="reference download internal" download="" href="../_downloads/2777c2eecc61df5220d0e35aa3a3f834/cb_2019_us_county_500k.shp"><code class="xref download docutils literal notranslate"><span class="pre">cb_2019_us_county_500k.shp</span></code></a> as a collection of <a class="reference external" href="https://en.wikipedia.org/wiki/Shapefile">Shapefiles</a>, and returns a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of county information.</p>
<p>If there is no serialized version of this dictionary, this method <em>also</em> serializes the data structure, <a class="reference download internal" download="" href="../_downloads/607b33927c78a28b1e4d60b439add143/fips_2019_data.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">fips_2019_data.pkl.gz</span></code></a>, for easy reloading.</p>
<p>Subsequently, if <a class="reference download internal" download="" href="../_downloads/607b33927c78a28b1e4d60b439add143/fips_2019_data.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">fips_2019_data.pkl.gz</span></code></a> exists, then loads that file and returns that object.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of US county geographic data. The key is the <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a> for the county. Each value is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bbox</span></code> is the lat/lng bounding box for that county.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">points</span></code> is a list of shapes for that county. Each shape is an <span class="math notranslate nohighlight">\(N \times 2\)</span> shaped <code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code>, with <span class="math notranslate nohighlight">\(N\)</span> points describing the boundary. Each row is the latitude and longitude of a point – first is the latitude, and second is the longitude</p></li>
</ul>
</p>
</dd>
</dl>
<p>This method uses <a class="reference external" href="https://github.com/GeospatialPython/pyshp">shapefile.Reader</a> to load in <a class="reference download internal" download="" href="../_downloads/2777c2eecc61df5220d0e35aa3a3f834/cb_2019_us_county_500k.shp"><code class="xref download docutils literal notranslate"><span class="pre">cb_2019_us_county_500k.shp</span></code></a> if <a class="reference download internal" download="" href="../_downloads/607b33927c78a28b1e4d60b439add143/fips_2019_data.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">fips_2019_data.pkl.gz</span></code></a> does not exist.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.create_and_store_fips_counties_2019">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">create_and_store_fips_counties_2019</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.create_and_store_fips_counties_2019" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>a two element <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>. The first element is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of <cite>FIPS code</cite> to a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> value: <code class="docutils literal notranslate"><span class="pre">county</span></code> and <code class="docutils literal notranslate"><span class="pre">state</span></code>. The second element is the reverse <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> (of county and state) to its <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a>.</p>
<p>The first <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> is stored in <a class="reference download internal" download="" href="../_downloads/156030e49b412adf13b1a4e5b3f21e79/all_2019_fips_cs_dict.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">all_2019_fips_cs_dict.pkl.gz</span></code></a>, and the second <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> is stored in <a class="reference download internal" download="" href="../_downloads/f7abe92a820944e22928437ca18d8f57/all_2019_cs_fips_dict.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">all_2019_cs_fips_dict.pkl.gz</span></code></a>.</p>
<p>If either file does not exist, then the dictionary is created and stored into the appropriate file.</p>
<p>If the file exists, then the object is loaded from that file.</p>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.create_and_store_msas_and_fips_2019">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">create_and_store_msas_and_fips_2019</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.create_and_store_msas_and_fips_2019" title="Permalink to this definition">¶</a></dt>
<dd><p>This returns a fully normalized <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s consistent with the the NY Times COVID-19 database. Also stores this data into the file, <a class="reference download internal" download="" href="../_downloads/e0144f11482e658248a5b4aa4549bd85/msa_2019_dict.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">msa_2019_dict.pkl.gz</span></code></a>, if it does not exist. If it does exist, then loads the file <a class="reference download internal" download="" href="../_downloads/e0144f11482e658248a5b4aa4549bd85/msa_2019_dict.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">msa_2019_dict.pkl.gz</span></code></a> and returns that data. It will also dump normalized <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a> data into <a class="reference download internal" download="" href="../_downloads/a1132515aa59e8133f656ff502be1bbe/msa_2019_post.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">msa_2019_post.pkl.gz</span></code></a>.</p>
<p>This method does four things:</p>
<ul class="simple">
<li><p>merges San Francisco, San Jose, and Napa <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s into the SF Bay Area.</p></li>
<li><p>merges NYC into the NYC metro area.</p></li>
<li><p>renames Washington, DC to the DC metro area.</p></li>
<li><p>merges Los Angeles, Riverside, and Oxnard <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s into the “Los Angeles” metro area (<a class="reference external" href="https://en.wikipedia.org/wiki/Greater_Los_Angeles">greater Los Angeles</a>).</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a> information. The key is the <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a> data <code class="docutils literal notranslate"><span class="pre">prefix</span></code>, and the value is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of <code class="docutils literal notranslate"><span class="pre">prefix</span></code>, <code class="docutils literal notranslate"><span class="pre">region</span> <span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">fips</span></code>, and <code class="docutils literal notranslate"><span class="pre">population</span></code>. For example, for <a class="reference external" href="https://en.wikipedia.org/wiki/Greater_St._Louis">St. Louis</a>, it is,</p>
<span class="target" id="stlouis-msa-example-data"></span><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;stlouis&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="s1">&#39;stlouis&#39;</span><span class="p">,</span>
  <span class="s1">&#39;region name&#39;</span><span class="p">:</span> <span class="s1">&#39;St. Louis Metro Area&#39;</span><span class="p">,</span>
  <span class="s1">&#39;fips&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;17005&#39;</span><span class="p">,</span>
   <span class="s1">&#39;17013&#39;</span><span class="p">,</span>
   <span class="s1">&#39;17027&#39;</span><span class="p">,</span>
   <span class="s1">&#39;17083&#39;</span><span class="p">,</span>
   <span class="s1">&#39;17117&#39;</span><span class="p">,</span>
   <span class="s1">&#39;17119&#39;</span><span class="p">,</span>
   <span class="s1">&#39;17133&#39;</span><span class="p">,</span>
   <span class="s1">&#39;17163&#39;</span><span class="p">,</span>
   <span class="s1">&#39;29071&#39;</span><span class="p">,</span>
   <span class="s1">&#39;29099&#39;</span><span class="p">,</span>
   <span class="s1">&#39;29113&#39;</span><span class="p">,</span>
   <span class="s1">&#39;29183&#39;</span><span class="p">,</span>
   <span class="s1">&#39;29189&#39;</span><span class="p">,</span>
   <span class="s1">&#39;29219&#39;</span><span class="p">,</span>
   <span class="s1">&#39;29510&#39;</span><span class="p">},</span>
  <span class="s1">&#39;population&#39;</span><span class="p">:</span> <span class="mi">2803228</span><span class="p">}}</span>
</pre></div>
</div>
</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.create_fips_popmap_2019">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">create_fips_popmap_2019</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.create_fips_popmap_2019" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of estimated 2019 US Census population in each US county or territory. Also stores this data into the file, <a class="reference download internal" download="" href="../_downloads/806a1806612c15caf767a52017c99ae2/fips_2019_popdict.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">fips_2019_popdict.pkl.gz</span></code></a>, if it does not exist. If it does exist, then loads the file <a class="reference download internal" download="" href="../_downloads/806a1806612c15caf767a52017c99ae2/fips_2019_popdict.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">fips_2019_popdict.pkl.gz</span></code></a> and returns that data.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a> to estimated 2019 US census population.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.create_msa_2019">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">create_msa_2019</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.create_msa_2019" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and returns <em>raw and unnormalized</em> <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">Metropolitan statistical area</a>s initially recorded in <a class="reference download internal" download="" href="../_downloads/3872dd5458b6f070c5811553a4ea80a5/msa_2019.csv"><code class="xref download docutils literal notranslate"><span class="pre">msa_2019.csv</span></code></a>, sorted by population from smallest to largest, and stores the object into <a class="reference download internal" download="" href="../_downloads/7027fa08d46310e17600dcfbf4050ef7/msa_2019.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">msa_2019.pkl.gz</span></code></a> if it does not exist. If <a class="reference download internal" download="" href="../_downloads/7027fa08d46310e17600dcfbf4050ef7/msa_2019.pkl.gz"><code class="xref download docutils literal notranslate"><span class="pre">msa_2019.pkl.gz</span></code></a>, then loads this files and returns the subsequent object.</p>
<p>Each entry in the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> looks like this. For example, for <a class="reference external" href="https://en.wikipedia.org/wiki/Greater_St._Louis">St. Louis, MO MSA</a>,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;msa&#39;</span><span class="p">:</span> <span class="mi">41180</span><span class="p">,</span>
 <span class="s1">&#39;pop est 2019&#39;</span><span class="p">:</span> <span class="mi">2803228</span><span class="p">,</span>
 <span class="s1">&#39;fips&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;17005&#39;</span><span class="p">,</span>
  <span class="s1">&#39;17013&#39;</span><span class="p">,</span>
  <span class="s1">&#39;17027&#39;</span><span class="p">,</span>
  <span class="s1">&#39;17083&#39;</span><span class="p">,</span>
  <span class="s1">&#39;17117&#39;</span><span class="p">,</span>
  <span class="s1">&#39;17119&#39;</span><span class="p">,</span>
  <span class="s1">&#39;17133&#39;</span><span class="p">,</span>
  <span class="s1">&#39;17163&#39;</span><span class="p">,</span>
  <span class="s1">&#39;29071&#39;</span><span class="p">,</span>
  <span class="s1">&#39;29099&#39;</span><span class="p">,</span>
  <span class="s1">&#39;29113&#39;</span><span class="p">,</span>
  <span class="s1">&#39;29183&#39;</span><span class="p">,</span>
  <span class="s1">&#39;29189&#39;</span><span class="p">,</span>
  <span class="s1">&#39;29219&#39;</span><span class="p">,</span>
  <span class="s1">&#39;29510&#39;</span><span class="p">},</span>
 <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;MO-IL&#39;</span><span class="p">,</span>
 <span class="s1">&#39;RNAME&#39;</span><span class="p">:</span> <span class="s1">&#39;St. Louis&#39;</span><span class="p">,</span>
 <span class="s1">&#39;prefix&#39;</span><span class="p">:</span> <span class="s1">&#39;stlouis&#39;</span><span class="p">,</span>
 <span class="s1">&#39;region name&#39;</span><span class="p">:</span> <span class="s1">&#39;St. Louis Metro Area&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The keys for each MSA are <code class="docutils literal notranslate"><span class="pre">msa</span></code> (an integer code), <code class="docutils literal notranslate"><span class="pre">pop</span> <span class="pre">est</span> <span class="pre">2019</span></code> is the US Census 2019 estimated population, <code class="docutils literal notranslate"><span class="pre">fips</span></code> is a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> of counties by <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a> located in this MSA, the <code class="docutils literal notranslate"><span class="pre">state</span></code> are the states this MSA covers, <code class="docutils literal notranslate"><span class="pre">RNAME</span></code> is a legend name for plotting, <code class="docutils literal notranslate"><span class="pre">prefix</span></code> is the name used to identify those files that contain data for this MSA, and <code class="docutils literal notranslate"><span class="pre">region</span> <span class="pre">name</span></code> is the common and accepted MSA name.</p>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_and_store_msas_and_fips</span></code> contains the fully normalized <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> of <cite>Metropolitan statistical area</cite>s used by the NY Times COVID-19 database, and <a class="reference internal" href="#covid19_stats.engine.gis.merge_msas" title="covid19_stats.engine.gis.merge_msas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">merge_msas</span></code></a> performs the normalization.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a sorted, but unnormalized, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of <cite>Metropolitan statistical area</cite>s as defined by the 2019 US Census.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.do_bbox_intersect">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">do_bbox_intersect</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bbox1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bbox2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.do_bbox_intersect" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks if two bounding boxes intersect.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bbox1</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a>) – the four-element <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of bounding box #1: minimum lng/lat, and maximum lng/lat.</p></li>
<li><p><strong>bbox2</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a>) – the four-element <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> of bounding box #2: minimum lng/lat, and maximum lng/lat.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if intersect, <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.get_fips_adjacency">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">get_fips_adjacency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fips</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fips_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.get_fips_adjacency" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds the <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a> of all counties adjacent to a specified county. For example, Sacramento County, with <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a> of 06067, has eight counties adjacent to it: 06005, 06013, 06017, 06061, 06077, 06095, 06101, 06113. <a class="reference internal" href="#gis-get-fips-adjacency-sacramento"><span class="std std-numref">Fig. 4.3</span></a> demonstrates that.</p>
<div class="figure align-left" id="id3">
<span id="gis-get-fips-adjacency-sacramento"></span><a class="reference internal image-reference" href="../_images/gis_get_fips_adjacency_sacramento.png"><img alt="../_images/gis_get_fips_adjacency_sacramento.png" src="../_images/gis_get_fips_adjacency_sacramento.png" style="width: 100%;" /></a>
<p class="caption"><span class="caption-number">Fig. 4.3 </span><span class="caption-text">Visualization of the eight counties adjacent to Sacramento County (06067). Sacramento County is accentuated for easier visualization here.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>Now here is the API description.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fips</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – the <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a> of the US county or territorial unit.</p></li>
<li><p><strong>fips_data</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – the US county <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> produced by, for example, <a class="reference internal" href="#covid19_stats.engine.gis.create_and_store_fips_2019" title="covid19_stats.engine.gis.create_and_store_fips_2019"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_and_store_fips_2019</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a>s of counties adjacent to <code class="docutils literal notranslate"><span class="pre">fips</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)">set</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covid19_stats.engine.gis.merge_msas">
<span class="sig-prename descclassname"><span class="pre">covid19_stats.engine.gis.</span></span><span class="sig-name descname"><span class="pre">merge_msas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">regionName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msaids</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_data_msas</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#covid19_stats.engine.gis.merge_msas" title="Permalink to this definition">¶</a></dt>
<dd><p>This takes an input <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>, defined by its <code class="docutils literal notranslate"><span class="pre">prefix</span></code>, gives it a new or existing <code class="docutils literal notranslate"><span class="pre">regionName</span></code>, by merging one or more <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> of <code class="docutils literal notranslate"><span class="pre">msaids</span></code>, in a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s as returned by, e.g., <a class="reference internal" href="#covid19_stats.engine.gis.create_msa_2019" title="covid19_stats.engine.gis.create_msa_2019"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_msa_2019</span></code></a>. It then returns a new <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s in the same format as <code class="docutils literal notranslate"><span class="pre">all_data_msas</span></code>.</p>
<p>This is used by, for example, normalizing the <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a> data by merging <em>all</em> five boroughs in NYC into a single fake county, <code class="docutils literal notranslate"><span class="pre">NYC</span></code>, in the New York City MSA.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>regionName</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – the region name (<code class="docutils literal notranslate"><span class="pre">region</span> <span class="pre">name</span></code> key) of the merged <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>.</p></li>
<li><p><strong>prefix</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – the named identifier of the <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a> to be merged.</p></li>
<li><p><strong>msaids</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.9)"><em>set</em></a>) – the collection of <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s to be merged into <code class="docutils literal notranslate"><span class="pre">prefix</span></code> <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>.</p></li>
<li><p><strong>all_data_msas</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – the input <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of county or US territory <a class="reference external" href="https://en.wikipedia.org/wiki/FIPS_county_code">FIPS code</a>s. Implicitly, <code class="docutils literal notranslate"><span class="pre">all_data_msas</span></code> must contain those the <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s identified by <code class="docutils literal notranslate"><span class="pre">prefix</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> of <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s in the same style as <code class="docutils literal notranslate"><span class="pre">all_data_msas</span></code>, sorted by population from lowest to highest. None of the <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s in this new collection contain <a class="reference external" href="https://en.wikipedia.org/wiki/Metropolitan_statistical_area">MSA</a>s in <code class="docutils literal notranslate"><span class="pre">msaids</span></code>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)">list</a></p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="covid19_stats_engine_core_api.html" class="btn btn-neutral float-right" title="4.4. covid19_stats.engine.core module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="covid19_stats_engine_api.html" class="btn btn-neutral float-left" title="4.2. covid19_stats.engine module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Tanim Islam.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>